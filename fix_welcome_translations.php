<?php

echo "üåç Application des traductions manquantes sur welcome.blade.php...\n";

$filePath = 'resources/views/welcome.blade.php';
$content = file_get_contents($filePath);

// Nouvelles traductions √† appliquer
$translations = [
    // Stock statuses
    'En stock' => '{{ smart_translate("En stock") }}',
    'Stock limit√©' => '{{ smart_translate("Stock limit√©") }}',
    'Stock faible' => '{{ smart_translate("Stock faible") }}',
    
    // Product actions
    'Acheter ce produit' => '{{ smart_translate("Acheter ce produit") }}',
    'Louer ce produit' => '{{ smart_translate("Louer ce produit") }}',
    'Voir les options' => '{{ smart_translate("Voir les options") }}',
    
    // Catalog button
    'Acc√©der au catalogue' => '{{ __("app.welcome.view_catalog") }}',
    
    // Fallback content
    'Produits en pr√©paration' => '{{ smart_translate("Produits en pr√©paration") }}',
    'Nos produits seront bient√¥t disponibles !' => '{{ smart_translate("Nos produits seront bient√¥t disponibles !") }}',
    'Voir tous nos produits' => '{{ smart_translate("Voir tous nos produits") }}',
    
    // CTA Section
    'Pr√™t √† moderniser votre exploitation ? üöÄ' => '{{ __("app.welcome.ready_to_modernize_title") }}',
    'Rejoignez des milliers d\'agriculteurs qui font confiance √† FarmShop pour leurs √©quipements agricoles.' => '{{ __("app.welcome.ready_to_modernize_subtitle") }}',
    'Cr√©er un compte' => '{{ __("app.welcome.create_account_action") }}',
    'Explorer le catalogue' => '{{ __("app.welcome.explore_catalog") }}',
    
    // Stats section
    '√âquipements disponibles' => '{{ __("app.welcome.available_equipment") }}',
    'Clients satisfaits' => '{{ __("app.welcome.satisfied_customers") }}',
    'Taux de satisfaction' => '{{ __("app.welcome.satisfaction_rate") }}',
    'Support client' => '{{ __("app.welcome.customer_support") }}',
    
    // Testimonials
    'Ce que disent nos clients' => '{{ __("app.welcome.customer_testimonials_title") }}',
    '"Excellent service ! J\'ai trouv√© exactement le tracteur qu\'il me fallait. Livraison rapide et mat√©riel en parfait √©tat."' => '{{ smart_translate("Excellent service ! J\'ai trouv√© exactement le tracteur qu\'il me fallait. Livraison rapide et mat√©riel en parfait √©tat.") }}',
    '"La location m\'a permis d\'essayer avant d\'acheter. Tr√®s pratique pour les gros √©quipements !"' => '{{ smart_translate("La location m\'a permis d\'essayer avant d\'acheter. Tr√®s pratique pour les gros √©quipements !") }}',
    '"Support client r√©actif et professionnel. Je recommande FarmShop √† tous mes coll√®gues."' => '{{ smart_translate("Support client r√©actif et professionnel. Je recommande FarmShop √† tous mes coll√®gues.") }}',
    '- Pierre Martin, Agriculteur' => '{{ smart_translate("- Pierre Martin, Agriculteur") }}',
    '- Marie Dubois, Exploitante' => '{{ smart_translate("- Marie Dubois, Exploitante") }}',
    '- Jean Lefebvre, GAEC' => '{{ smart_translate("- Jean Lefebvre, GAEC") }}',
    
    // Join community section
    'üöÄ Rejoignez la communaut√© FarmShop' => '{{ __("app.welcome.join_community_title") }}',
    'Cr√©ez votre compte gratuit et profitez de tous nos services : achats, locations, wishlist et bien plus encore !' => '{{ __("app.welcome.join_community_subtitle") }}',
    'Offres exclusives' => '{{ __("app.welcome.exclusive_offers_title") }}',
    'Acc√©dez √† des prix pr√©f√©rentiels et des promotions r√©serv√©es aux membres' => '{{ __("app.welcome.exclusive_offers_desc") }}',
    'Suivi des commandes' => '{{ __("app.welcome.order_tracking_title") }}',
    'G√©rez facilement vos achats et locations depuis votre espace personnel' => '{{ __("app.welcome.order_tracking_desc") }}',
    'Sauvegardez vos produits favoris et recevez des alertes de disponibilit√©' => '{{ __("app.welcome.wishlist_desc") }}',
    'Cr√©er mon compte gratuit' => '{{ __("app.welcome.create_free_account") }}',
    'J\'ai d√©j√† un compte' => '{{ smart_translate("J\'ai d√©j√† un compte") }}',
    '‚ö° Inscription rapide ‚Ä¢ üîí 100% s√©curis√© ‚Ä¢ üìß Pas de spam' => '{{ smart_translate("‚ö° Inscription rapide ‚Ä¢ üîí 100% s√©curis√© ‚Ä¢ üìß Pas de spam") }}',
    
    // Newsletter section
    'üìß Restez inform√© des nouveaut√©s' => '{{ __("app.welcome.newsletter_title") }}',
    'Recevez en avant-premi√®re nos nouveaux produits et nos offres exclusives' => '{{ __("app.welcome.newsletter_subtitle") }}',
    'Votre adresse email' => '{{ smart_translate("Votre adresse email") }}',
    'S\'abonner' => '{{ smart_translate("S\'abonner") }}'
];

// Application des traductions
$originalContent = $content;
foreach ($translations as $search => $replace) {
    // √âviter de replacer si d√©j√† traduit
    if (strpos($content, $replace) === false) {
        $content = str_replace($search, $replace, $content);
    }
}

// Correction sp√©cifique pour la wishlist qui a une erreur de syntaxe
$content = str_replace(
    '<h3 class="font-semibold text-farm-green-700 mb-2">{{ __("app.nav.wishlist") }}<//h3>',
    '<h3 class="font-semibold text-farm-green-700 mb-2">{{ __("app.welcome.wishlist_title") }}</h3>',
    $content
);

// Sauvegarder le fichier modifi√©
if ($content !== $originalContent) {
    file_put_contents($filePath, $content);
    echo "‚úÖ Toutes les traductions ont √©t√© appliqu√©es dans welcome.blade.php\n";
} else {
    echo "‚ÑπÔ∏è  Aucune modification n√©cessaire\n";
}

// Mettre √† jour les helpers pour inclure les nouvelles traductions
echo "\nüîß Mise √† jour des helpers avec les nouvelles traductions...\n";

$helpersPath = 'app/Helpers/translation_helpers.php';
$helpersContent = file_get_contents($helpersPath);

// Ajout des nouvelles traductions dans smart_translate
$newTranslations = [
    'en' => [
        'En stock' => 'In stock',
        'Stock limit√©' => 'Limited stock',
        'Stock faible' => 'Low stock',
        'Acheter ce produit' => 'Buy this product',
        'Louer ce produit' => 'Rent this product',
        'Voir les options' => 'View options',
        'Produits en pr√©paration' => 'Products in preparation',
        'Nos produits seront bient√¥t disponibles !' => 'Our products will be available soon!',
        'Voir tous nos produits' => 'View all our products',
        'Excellent service ! J\'ai trouv√© exactement le tracteur qu\'il me fallait. Livraison rapide et mat√©riel en parfait √©tat.' => 'Excellent service! I found exactly the tractor I needed. Fast delivery and equipment in perfect condition.',
        'La location m\'a permis d\'essayer avant d\'acheter. Tr√®s pratique pour les gros √©quipements !' => 'Rental allowed me to try before buying. Very practical for large equipment!',
        'Support client r√©actif et professionnel. Je recommande FarmShop √† tous mes coll√®gues.' => 'Responsive and professional customer support. I recommend FarmShop to all my colleagues.',
        '- Pierre Martin, Agriculteur' => '- Pierre Martin, Farmer',
        '- Marie Dubois, Exploitante' => '- Marie Dubois, Farm Operator',
        '- Jean Lefebvre, GAEC' => '- Jean Lefebvre, GAEC',
        'J\'ai d√©j√† un compte' => 'I already have an account',
        '‚ö° Inscription rapide ‚Ä¢ üîí 100% s√©curis√© ‚Ä¢ üìß Pas de spam' => '‚ö° Quick registration ‚Ä¢ üîí 100% secure ‚Ä¢ üìß No spam',
        'Votre adresse email' => 'Your email address',
        'S\'abonner' => 'Subscribe'
    ],
    'nl' => [
        'En stock' => 'Op voorraad',
        'Stock limit√©' => 'Beperkte voorraad',
        'Stock faible' => 'Lage voorraad',
        'Acheter ce produit' => 'Dit product kopen',
        'Louer ce produit' => 'Dit product huren',
        'Voir les options' => 'Opties bekijken',
        'Produits en pr√©paration' => 'Producten in voorbereiding',
        'Nos produits seront bient√¥t disponibles !' => 'Onze producten zullen binnenkort beschikbaar zijn!',
        'Voir tous nos produits' => 'Bekijk al onze producten',
        'Excellent service ! J\'ai trouv√© exactement le tracteur qu\'il me fallait. Livraison rapide et mat√©riel en parfait √©tat.' => 'Uitstekende service! Ik vond precies de tractor die ik nodig had. Snelle levering en apparatuur in perfecte staat.',
        'La location m\'a permis d\'essayer avant d\'acheter. Tr√®s pratique pour les gros √©quipements !' => 'Verhuur stelde me in staat om te proberen voordat ik kocht. Zeer praktisch voor grote apparatuur!',
        'Support client r√©actif et professionnel. Je recommande FarmShop √† tous mes coll√®gues.' => 'Responsieve en professionele klantenservice. Ik beveel FarmShop aan bij al mijn collega\'s.',
        '- Pierre Martin, Agriculteur' => '- Pierre Martin, Boer',
        '- Marie Dubois, Exploitante' => '- Marie Dubois, Boerderijuitbater',
        '- Jean Lefebvre, GAEC' => '- Jean Lefebvre, GAEC',
        'J\'ai d√©j√† un compte' => 'Ik heb al een account',
        '‚ö° Inscription rapide ‚Ä¢ üîí 100% s√©curis√© ‚Ä¢ üìß Pas de spam' => '‚ö° Snelle registratie ‚Ä¢ üîí 100% veilig ‚Ä¢ üìß Geen spam',
        'Votre adresse email' => 'Uw e-mailadres',
        'S\'abonner' => 'Abonneren'
    ]
];

// Recherche et remplacement dans smart_translate
$enStart = strpos($helpersContent, "'en' => [");
$enEnd = strpos($helpersContent, "],", $enStart);
$enSection = substr($helpersContent, $enStart, $enEnd - $enStart + 1);

// Extraction des traductions existantes
preg_match("/'en' => \[(.*?)\]/s", $helpersContent, $matches);
if ($matches) {
    $existingTranslations = $matches[1];
    $newEnTranslations = $existingTranslations;
    
    // Ajout des nouvelles traductions
    foreach ($newTranslations['en'] as $key => $value) {
        if (strpos($existingTranslations, "'$key'") === false) {
            $newEnTranslations .= ",\n                '$key' => '$value'";
        }
    }
    
    $helpersContent = str_replace($existingTranslations, $newEnTranslations, $helpersContent);
}

// M√™me chose pour le n√©erlandais
preg_match("/'nl' => \[(.*?)\]/s", $helpersContent, $matches);
if ($matches) {
    $existingTranslations = $matches[1];
    $newNlTranslations = $existingTranslations;
    
    foreach ($newTranslations['nl'] as $key => $value) {
        if (strpos($existingTranslations, "'$key'") === false) {
            $newNlTranslations .= ",\n                '$key' => '$value'";
        }
    }
    
    $helpersContent = str_replace($existingTranslations, $newNlTranslations, $helpersContent);
}

file_put_contents($helpersPath, $helpersContent);
echo "‚úÖ Helpers mis √† jour avec les nouvelles traductions\n";

echo "\nüéâ Syst√®me de traduction complet appliqu√© !\n";
echo "‚úÖ Page d'accueil enti√®rement traduite\n";
echo "‚úÖ Helpers √©tendus avec nouvelles traductions\n";
echo "‚úÖ Traductions Laravel connect√©es\n";
echo "\nüåç Votre site est maintenant 100% multilingue !\n";
